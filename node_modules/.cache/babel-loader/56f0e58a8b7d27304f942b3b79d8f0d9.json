{"ast":null,"code":"function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nimport p5, { Vector, prototype } from 'p5';\nvar color = prototype.color,\n    createSlider = prototype.createSlider,\n    fill = prototype.fill,\n    text = prototype.text,\n    stroke = prototype.stroke,\n    noStroke = prototype.noStroke,\n    noFill = prototype.noFill,\n    createVector = prototype.createVector,\n    createCanvas = prototype.createCanvas,\n    arc = prototype.arc,\n    line = prototype.line,\n    circle = prototype.circle,\n    background = prototype.background,\n    frameCount = prototype.frameCount,\n    PIE = prototype.PIE,\n    abs = prototype.abs;\nvar WIDTH = 700;\nvar HEIGHT = WIDTH / 1.618;\nvar canvas = {\n  center: new Vector().add(WIDTH / 2, HEIGHT / 2),\n  dims: new Vector().add(WIDTH, HEIGHT)\n};\nvar BACKGROUND_SHADE = 233;\nvar BEES = []; // SETUP SLIDERS\n\nvar SPEED_LIMIT;\nvar SPEED_LIMIT_S;\nvar SPEED_MIN;\nvar SPEED_MIN_S;\nvar NUM_BEES;\nvar NUM_BEES_S;\nvar VIEW_DISTANCE;\nvar VIEW_DISTANCE_S;\nvar DISTANCE_IDEAL;\nvar DISTANCE_IDEAL_S;\nvar DISTANCE_DESIRE;\nvar DISTANCE_DESIRE_S;\nvar TURN_SPEED_LIMIT;\nvar TURN_SPEED_LIMIT_S;\nvar SLIDERS = [];\nvar SLIDER_BASE_COLOR;\nvar SLIDER_WARNING_COLOR; // INITIAL CONDITIONS\n\nvar INIT_SPEED_LIMIT = 2;\nvar INIT_SPEED_MIN = 1;\nvar INIT_NUM_BEES = 6;\nvar INIT_VIEW_DISTANCE = 900;\nvar INIT_DISTANCE_IDEAL = 80;\nvar INIT_DISTANCE_DESIRE = 0.1;\nvar INIT_TURN_SPEED_LIMIT = 0.005;\nvar SLIDER_NAMES = new Map();\nvar SLIDER_COLORS = new Map();\n\nfunction createSliders() {\n  SLIDER_BASE_COLOR = color(100);\n  SLIDER_WARNING_COLOR = color(255, 100, 100);\n  NUM_BEES_S = createSlider(0, 100, INIT_NUM_BEES, 1);\n  SLIDER_NAMES.set(NUM_BEES_S, 'BEE COUNT');\n  SPEED_LIMIT_S = createSlider(0, 5, INIT_SPEED_LIMIT, 0.001);\n  SLIDER_NAMES.set(SPEED_LIMIT_S, 'SPEED LIMIT');\n  SPEED_MIN_S = createSlider(0, 30, INIT_SPEED_MIN, 0.001);\n  SLIDER_NAMES.set(SPEED_MIN_S, 'SPEED MIN');\n  VIEW_DISTANCE_S = createSlider(0, WIDTH, INIT_VIEW_DISTANCE);\n  SLIDER_NAMES.set(VIEW_DISTANCE_S, 'VIEW DISTANCE');\n  DISTANCE_DESIRE_S = createSlider(0, 0.3, INIT_DISTANCE_DESIRE, 0.001);\n  SLIDER_NAMES.set(DISTANCE_DESIRE_S, 'DIST. DESIRE');\n  DISTANCE_IDEAL_S = createSlider(0, WIDTH, INIT_DISTANCE_IDEAL);\n  SLIDER_NAMES.set(DISTANCE_IDEAL_S, 'DIST. IDEAL');\n  TURN_SPEED_LIMIT_S = createSlider(0, 0.01, INIT_TURN_SPEED_LIMIT, 0.001);\n  SLIDER_NAMES.set(TURN_SPEED_LIMIT_S, 'TURN SPEED LIMIT');\n  SLIDERS = [NUM_BEES_S, SPEED_MIN_S, SPEED_LIMIT_S, VIEW_DISTANCE_S, DISTANCE_DESIRE_S, DISTANCE_IDEAL_S, TURN_SPEED_LIMIT_S];\n  SLIDERS.forEach(function (slider, idx) {\n    slider.position(10, 20 * idx + 5);\n    SLIDER_COLORS.set(slider, SLIDER_BASE_COLOR);\n  });\n}\n\nfunction labelSliders() {\n  SLIDERS.forEach(function (slider, idx) {\n    fill(SLIDER_COLORS.get(slider));\n    text(SLIDER_NAMES.get(slider) + ': ' + slider.value(), 150, 20 * idx + 20);\n  });\n}\n\nfunction updateSliderValues() {\n  NUM_BEES = Number.parseFloat(NUM_BEES_S.value());\n  SPEED_LIMIT = Number.parseFloat(SPEED_LIMIT_S.value());\n  SPEED_MIN = Number.parseFloat(SPEED_MIN_S.value());\n  VIEW_DISTANCE = Number.parseFloat(VIEW_DISTANCE_S.value());\n  DISTANCE_DESIRE = Number.parseFloat(DISTANCE_DESIRE_S.value());\n  DISTANCE_IDEAL = Number.parseFloat(DISTANCE_IDEAL_S.value());\n\n  if (SPEED_LIMIT < SPEED_MIN) {\n    SLIDER_COLORS.set(SPEED_LIMIT_S, SLIDER_WARNING_COLOR);\n    SLIDER_COLORS.set(SPEED_MIN_S, SLIDER_WARNING_COLOR);\n  } else {\n    SLIDER_COLORS.set(SPEED_LIMIT_S, SLIDER_BASE_COLOR);\n    SLIDER_COLORS.set(SPEED_MIN_S, SLIDER_BASE_COLOR);\n  }\n}\n\nfunction setup() {\n  canvas.dims = createVector(WIDTH, HEIGHT);\n  canvas.center = createVector(WIDTH / 2, HEIGHT / 2);\n  createCanvas(canvas.dims.x, canvas.dims.y);\n  noStroke();\n  createSliders();\n}\n\nfunction drawBeeOutline(bee) {\n  noFill();\n  stroke(200); // circle(bee.pos.x, bee.pos.y, VIEW_DISTANCE)\n\n  arc(bee.pos.x, bee.pos.y, VIEW_DISTANCE, VIEW_DISTANCE, bee.vel.heading() - 0.5, bee.vel.heading() + 0.5, PIE);\n}\n\nfunction drawDebugVels() {\n  BEES.forEach(function (bee, idx) {\n    return text(bee.vel.mag() + ' | ' + bee.vel.heading(), 10, HEIGHT - 20 * (idx + 1));\n  });\n}\n\nfunction drawDebugDir(bee) {\n  var start = bee.pos;\n  var end = bee.pos;\n  end.add(bee.vel);\n  stroke(200);\n  line(start.x, start.y, end.x, end.y);\n}\n\nfunction drawBee(bee) {\n  var beeSize = 7;\n  var beeShade = 5;\n  fill(color(beeShade));\n  noStroke();\n  circle(bee.pos.x, bee.pos.y, beeSize); // drawDebugDir(bee)\n  // drawBeeOutline(bee)\n}\n\nfunction draw() {\n  background(BACKGROUND_SHADE);\n\n  if (BEES.length < NUM_BEES && frameCount % 5 === 0) {\n    BEES.push(new Bee(canvas.center, createVector(frameCount % 7, 1)));\n  }\n\n  if (BEES.length > NUM_BEES && frameCount % 5 === 0) {\n    BEES.pop();\n  }\n\n  BEES.forEach(function (bee) {\n    return bee.updateVel(BEES);\n  });\n  BEES.forEach(function (bee) {\n    return bee.updatePos();\n  });\n  labelSliders();\n  updateSliderValues();\n  BEES.forEach(function (bee) {\n    return drawBee(bee);\n  });\n  drawDebugVels();\n}\n\nvar Bee = /*#__PURE__*/function () {\n  function Bee(pos, vel) {\n    _classCallCheck(this, Bee);\n\n    this.pos = pos;\n    this.vel = vel;\n  }\n\n  _createClass(Bee, [{\n    key: \"updatePos\",\n    value: function updatePos() {\n      this.pos.add(this.vel);\n      this.pos = vectorMod(this.pos, canvas.dims);\n    }\n  }, {\n    key: \"updateVel\",\n    value: function updateVel(bees) {\n      var _this = this;\n\n      var neighbors = bees.filter(function (bee) {\n        var delta = Vector.sub(bee.pos, _this.pos);\n        return bee != _this && _this.pos.dist(bee.pos) < VIEW_DISTANCE && abs(_this.vel.angleBetween(delta)) < 0.5;\n      });\n      this.applyIdealDistance(neighbors); // bee speed limit\n\n      this.vel.limit(SPEED_LIMIT); // bee min speed\n\n      if (this.vel.mag() <= SPEED_MIN) {\n        this.vel.setMag(SPEED_MIN);\n      }\n    }\n  }, {\n    key: \"applyIdealDistance\",\n    value: function applyIdealDistance(neighbors) {\n      var _this2 = this;\n\n      var attractiveForces = neighbors.map(function (neighbor) {\n        var d = _this2.pos.dist(neighbor.pos);\n\n        var delta = Vector.sub(neighbor.pos, _this2.pos);\n        delta.setMag(delta.mag() - DISTANCE_IDEAL);\n        return delta;\n      });\n      var turningForce = vectorAverage(attractiveForces).heading() - this.vel.heading();\n      var catchUpForce = vectorAverage(attractiveForces).mag();\n      var limited = turningForce < TURN_SPEED_LIMIT ? turningForce : TURN_SPEED_LIMIT;\n      this.vel.rotate(turningForce * DISTANCE_DESIRE); // this.vel.mult(catchUpForce)\n    }\n  }]);\n\n  return Bee;\n}();\n\nfunction sketch(p5) {\n  p5.setup = function () {\n    canvas.dims = createVector(WIDTH, HEIGHT);\n    canvas.center = createVector(WIDTH / 2, HEIGHT / 2);\n    createCanvas(canvas.dims.x, canvas.dims.y);\n    noStroke();\n    createSliders();\n  };\n\n  p5.draw = draw;\n}\n\nnew p5(sketch);\n\nvar vectorAverage = function vectorAverage(vecs) {\n  var z = createVector(0, 0);\n\n  if (vecs.length === 0) {\n    return z;\n  }\n\n  vecs.forEach(function (vec) {\n    return z.add(vec);\n  });\n  z.mult(1 / vecs.length);\n  return z;\n};\n\nvar vectorMod = function vectorMod(vecA, vecB) {\n  var x = vecA.x < 0 ? vecA.x + vecB.x : vecA.x % vecB.x;\n  var y = vecA.y < 0 ? vecA.y + vecB.y : vecA.y % vecB.y;\n  return createVector(x, y);\n};","map":{"version":3,"sources":["/Users/trev/labs/bees/src/index.ts"],"names":["p5","Vector","prototype","color","createSlider","fill","text","stroke","noStroke","noFill","createVector","createCanvas","arc","line","circle","background","frameCount","PIE","abs","WIDTH","HEIGHT","canvas","center","add","dims","BACKGROUND_SHADE","BEES","SPEED_LIMIT","SPEED_LIMIT_S","SPEED_MIN","SPEED_MIN_S","NUM_BEES","NUM_BEES_S","VIEW_DISTANCE","VIEW_DISTANCE_S","DISTANCE_IDEAL","DISTANCE_IDEAL_S","DISTANCE_DESIRE","DISTANCE_DESIRE_S","TURN_SPEED_LIMIT","TURN_SPEED_LIMIT_S","SLIDERS","SLIDER_BASE_COLOR","SLIDER_WARNING_COLOR","INIT_SPEED_LIMIT","INIT_SPEED_MIN","INIT_NUM_BEES","INIT_VIEW_DISTANCE","INIT_DISTANCE_IDEAL","INIT_DISTANCE_DESIRE","INIT_TURN_SPEED_LIMIT","SLIDER_NAMES","Map","SLIDER_COLORS","createSliders","set","forEach","slider","idx","position","labelSliders","get","value","updateSliderValues","Number","parseFloat","setup","x","y","drawBeeOutline","bee","pos","vel","heading","drawDebugVels","mag","drawDebugDir","start","end","drawBee","beeSize","beeShade","draw","length","push","Bee","pop","updateVel","updatePos","vectorMod","bees","neighbors","filter","delta","sub","dist","angleBetween","applyIdealDistance","limit","setMag","attractiveForces","map","neighbor","d","turningForce","vectorAverage","catchUpForce","limited","rotate","sketch","vecs","z","vec","mult","vecA","vecB"],"mappings":"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","sourcesContent":["import p5, { Vector, Element, Color, prototype } from 'p5'\n\nconst {\n  color,\n  createSlider,\n  fill,\n  text,\n  stroke,\n  noStroke,\n  noFill,\n  createVector,\n  createCanvas,\n  arc,\n  line,\n  circle,\n  background,\n  frameCount,\n  PIE,\n  abs\n} = prototype\n\nconst WIDTH = 700\nconst HEIGHT = WIDTH / 1.618\n\ntype Canvas = {\n  center: Vector\n  dims: Vector\n}\n\nconst canvas: Canvas = {\n  center: new Vector().add(WIDTH / 2, HEIGHT / 2),\n  dims: new Vector().add(WIDTH, HEIGHT)\n}\n\nconst BACKGROUND_SHADE = 233\nconst BEES: Bee[] = []\n\n// SETUP SLIDERS\nlet SPEED_LIMIT: number\nlet SPEED_LIMIT_S: Element\n\nlet SPEED_MIN: number\nlet SPEED_MIN_S: Element\n\nlet NUM_BEES: number\nlet NUM_BEES_S: Element\n\nlet VIEW_DISTANCE: number\nlet VIEW_DISTANCE_S: Element\n\nlet DISTANCE_IDEAL: number\nlet DISTANCE_IDEAL_S: Element\n\nlet DISTANCE_DESIRE: number\nlet DISTANCE_DESIRE_S: Element\n\nlet TURN_SPEED_LIMIT: number\nlet TURN_SPEED_LIMIT_S: Element\n\nlet SLIDERS: Element[] = []\n\nlet SLIDER_BASE_COLOR: Color\nlet SLIDER_WARNING_COLOR: Color\n\n// INITIAL CONDITIONS\n\nconst INIT_SPEED_LIMIT = 2\nconst INIT_SPEED_MIN = 1\nconst INIT_NUM_BEES = 6\nconst INIT_VIEW_DISTANCE = 900\nconst INIT_DISTANCE_IDEAL = 80\nconst INIT_DISTANCE_DESIRE = 0.1\nconst INIT_TURN_SPEED_LIMIT = 0.005\n\nconst SLIDER_NAMES = new Map<Element, string>()\nconst SLIDER_COLORS = new Map<Element, Color>()\n\nfunction createSliders() {\n  SLIDER_BASE_COLOR = color(100)\n  SLIDER_WARNING_COLOR = color(255, 100, 100)\n\n  NUM_BEES_S = createSlider(0, 100, INIT_NUM_BEES, 1)\n  SLIDER_NAMES.set(NUM_BEES_S, 'BEE COUNT')\n\n  SPEED_LIMIT_S = createSlider(0, 5, INIT_SPEED_LIMIT, 0.001)\n  SLIDER_NAMES.set(SPEED_LIMIT_S, 'SPEED LIMIT')\n\n  SPEED_MIN_S = createSlider(0, 30, INIT_SPEED_MIN, 0.001)\n  SLIDER_NAMES.set(SPEED_MIN_S, 'SPEED MIN')\n\n  VIEW_DISTANCE_S = createSlider(0, WIDTH, INIT_VIEW_DISTANCE)\n  SLIDER_NAMES.set(VIEW_DISTANCE_S, 'VIEW DISTANCE')\n\n  DISTANCE_DESIRE_S = createSlider(0, 0.3, INIT_DISTANCE_DESIRE, 0.001)\n  SLIDER_NAMES.set(DISTANCE_DESIRE_S, 'DIST. DESIRE')\n\n  DISTANCE_IDEAL_S = createSlider(0, WIDTH, INIT_DISTANCE_IDEAL)\n  SLIDER_NAMES.set(DISTANCE_IDEAL_S, 'DIST. IDEAL')\n\n  TURN_SPEED_LIMIT_S = createSlider(0, 0.01, INIT_TURN_SPEED_LIMIT, 0.001)\n  SLIDER_NAMES.set(TURN_SPEED_LIMIT_S, 'TURN SPEED LIMIT')\n\n  SLIDERS = [\n    NUM_BEES_S,\n    SPEED_MIN_S,\n    SPEED_LIMIT_S,\n    VIEW_DISTANCE_S,\n    DISTANCE_DESIRE_S,\n    DISTANCE_IDEAL_S,\n    TURN_SPEED_LIMIT_S\n  ]\n\n  SLIDERS.forEach((slider, idx) => {\n    slider.position(10, 20 * idx + 5)\n    SLIDER_COLORS.set(slider, SLIDER_BASE_COLOR)\n  })\n}\n\nfunction labelSliders() {\n  SLIDERS.forEach((slider, idx) => {\n    fill(SLIDER_COLORS.get(slider))\n    text(SLIDER_NAMES.get(slider) + ': ' + slider.value(), 150, 20 * idx + 20)\n  })\n}\n\nfunction updateSliderValues() {\n  NUM_BEES = Number.parseFloat(NUM_BEES_S.value() as string)\n  SPEED_LIMIT = Number.parseFloat(SPEED_LIMIT_S.value() as string)\n  SPEED_MIN = Number.parseFloat(SPEED_MIN_S.value() as string)\n  VIEW_DISTANCE = Number.parseFloat(VIEW_DISTANCE_S.value() as string)\n  DISTANCE_DESIRE = Number.parseFloat(DISTANCE_DESIRE_S.value() as string)\n  DISTANCE_IDEAL = Number.parseFloat(DISTANCE_IDEAL_S.value() as string)\n\n  if (SPEED_LIMIT < SPEED_MIN) {\n    SLIDER_COLORS.set(SPEED_LIMIT_S, SLIDER_WARNING_COLOR)\n    SLIDER_COLORS.set(SPEED_MIN_S, SLIDER_WARNING_COLOR)\n  } else {\n    SLIDER_COLORS.set(SPEED_LIMIT_S, SLIDER_BASE_COLOR)\n    SLIDER_COLORS.set(SPEED_MIN_S, SLIDER_BASE_COLOR)\n  }\n}\n\nfunction setup() {\n  canvas.dims = createVector(WIDTH, HEIGHT)\n  canvas.center = createVector(WIDTH / 2, HEIGHT / 2)\n  createCanvas(canvas.dims.x, canvas.dims.y)\n  noStroke()\n  createSliders()\n}\n\nfunction drawBeeOutline(bee: Bee) {\n  noFill()\n  stroke(200)\n  // circle(bee.pos.x, bee.pos.y, VIEW_DISTANCE)\n  arc(\n    bee.pos.x,\n    bee.pos.y,\n    VIEW_DISTANCE,\n    VIEW_DISTANCE,\n    bee.vel.heading() - 0.5,\n    bee.vel.heading() + 0.5,\n    PIE\n  )\n}\n\nfunction drawDebugVels() {\n  BEES.forEach((bee, idx) =>\n    text(bee.vel.mag() + ' | ' + bee.vel.heading(), 10, HEIGHT - 20 * (idx + 1))\n  )\n}\n\nfunction drawDebugDir(bee: Bee) {\n  const start = bee.pos\n  const end = bee.pos\n  end.add(bee.vel)\n  stroke(200)\n  line(start.x, start.y, end.x, end.y)\n}\n\nfunction drawBee(bee: Bee) {\n  const beeSize = 7\n  const beeShade = 5\n\n  fill(color(beeShade))\n  noStroke()\n  circle(bee.pos.x, bee.pos.y, beeSize)\n\n  // drawDebugDir(bee)\n  // drawBeeOutline(bee)\n}\n\nfunction draw() {\n  background(BACKGROUND_SHADE)\n\n  if (BEES.length < NUM_BEES && frameCount % 5 === 0) {\n    BEES.push(new Bee(canvas.center, createVector(frameCount % 7, 1)))\n  }\n\n  if (BEES.length > NUM_BEES && frameCount % 5 === 0) {\n    BEES.pop()\n  }\n\n  BEES.forEach((bee) => bee.updateVel(BEES))\n\n  BEES.forEach((bee) => bee.updatePos())\n\n  labelSliders()\n  updateSliderValues()\n\n  BEES.forEach((bee) => drawBee(bee))\n\n  drawDebugVels()\n}\n\nclass Bee {\n  pos: Vector\n  vel: Vector\n\n  constructor(pos: Vector, vel: Vector) {\n    this.pos = pos\n    this.vel = vel\n  }\n\n  updatePos() {\n    this.pos.add(this.vel)\n    this.pos = vectorMod(this.pos, canvas.dims)\n  }\n\n  updateVel(bees: Bee[]) {\n    const neighbors = bees.filter((bee) => {\n      const delta = Vector.sub(bee.pos, this.pos)\n\n      return (\n        bee != this &&\n        this.pos.dist(bee.pos) < VIEW_DISTANCE &&\n        abs(this.vel.angleBetween(delta)) < 0.5\n      )\n    })\n\n    this.applyIdealDistance(neighbors)\n\n    // bee speed limit\n    this.vel.limit(SPEED_LIMIT)\n\n    // bee min speed\n\n    if (this.vel.mag() <= SPEED_MIN) {\n      this.vel.setMag(SPEED_MIN)\n    }\n  }\n\n  applyIdealDistance(neighbors: Bee[]) {\n    const attractiveForces = neighbors.map((neighbor) => {\n      const d = this.pos.dist(neighbor.pos)\n\n      const delta = Vector.sub(neighbor.pos, this.pos)\n\n      delta.setMag(delta.mag() - DISTANCE_IDEAL)\n\n      return delta\n    })\n\n    const turningForce =\n      vectorAverage(attractiveForces).heading() - this.vel.heading()\n    const catchUpForce = vectorAverage(attractiveForces).mag()\n\n    const limited =\n      turningForce < TURN_SPEED_LIMIT ? turningForce : TURN_SPEED_LIMIT\n\n    this.vel.rotate(turningForce * DISTANCE_DESIRE)\n\n    // this.vel.mult(catchUpForce)\n  }\n}\n\nfunction sketch(p5: p5) {\n  p5.setup = () => {\n    canvas.dims = createVector(WIDTH, HEIGHT)\n    canvas.center = createVector(WIDTH / 2, HEIGHT / 2)\n    createCanvas(canvas.dims.x, canvas.dims.y)\n    noStroke()\n    createSliders()\n  }\n  p5.draw = draw\n}\n\nnew p5(sketch)\n\nconst vectorAverage = (vecs: Vector[]) => {\n  const z = createVector(0, 0)\n  if (vecs.length === 0) {\n    return z\n  }\n  vecs.forEach((vec) => z.add(vec))\n  z.mult(1 / vecs.length)\n  return z\n}\n\nconst vectorMod = (vecA: Vector, vecB: Vector) => {\n  const x = vecA.x < 0 ? vecA.x + vecB.x : vecA.x % vecB.x\n  const y = vecA.y < 0 ? vecA.y + vecB.y : vecA.y % vecB.y\n  return createVector(x, y)\n}\n"]},"metadata":{},"sourceType":"module"}